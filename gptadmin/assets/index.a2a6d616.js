var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,n=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,r=(e,a)=>{for(var t in a||(a={}))o.call(a,t)&&n(e,t,a[t]);if(l)for(var t of l(a))s.call(a,t)&&n(e,t,a[t]);return e},d=(e,l)=>a(e,t(l));import{d as i,c,f as p,e as u}from"./index.a35ddce3.js";import{a as m,m as f,M as h,E as y,r as b,a0 as g,d as v,u as V,h as w,i as _,c as C,f as x,w as P,b as k,P as D,Q as S,R as M,au as I,t as T,H as U,g as G,bw as j,o as R,az as B,e as O,bb as z,av as q,aA as E}from"./vendor.1bc4be78.js";import{u as L}from"./useDialog.9249a547.js";import{u as H}from"./useBasicForm.a463284a.js";import{a as A}from"./index.a7987ea2.js";import{u as F}from"./useBasicTable.a2a9fef8.js";const Q=(e=!1,a=!1)=>[{field:"name",component:"Input",label:"模型名称",required:!0,componentProps:{placeholder:"请输入模型名称"}},{field:"type",component:"Input",label:"类型",required:!0,slot:"type",defaultValue:"1"},{field:"system",component:"Input",label:"咒语",required:!0,componentProps:{type:"textarea",rows:6,placeholder:"请输入咒语"}},{field:"desc",component:"Input",label:"模型描述",required:!0,componentProps:{type:"textarea",rows:2,placeholder:"请输入模型描述"}},{field:"remark",component:"Input",label:"备注",componentProps:{type:"textarea",rows:2,placeholder:"请输入备注"}},{field:"prompt",component:"Input",label:e?"示例":"开场语",required:!0,slot:"prompt"}];const W=()=>{const e=m({}),a=f();return d(r({},h(e)),{onModelShow:async(e,a,t="mf")=>{const l={id:e.id,status:1==e.status?"2":"1"};"gpt"===t&&(l.status=e.status);try{const{err_code:e}=await A().chatGPT.putChatGptModelStatus(r({},l));e||a&&a()}catch(o){}},onCreateModel:async(e,a)=>{try{const t=!!e.id,{err_code:l}=await A().chatGPT[t?"putChatGptModel":"saveChatGptModel"](r({},e));l||(y.success(t?"修改成功":"新增成功"),a&&a())}catch(t){}},handleCopyModel:async(e,t="list")=>a.push({path:`/model/modelManager/${t}`,query:{id:e}}),handleModelTop:async(e,a,t)=>{try{const{err_code:l}=await A().model[a?"cancelTop":"modelTop"]({id:e});l||(y.success(a?"取消置顶成功":"置顶成功"),t&&t())}catch(l){}},onGetModalInfo:e=>new Promise(((a,t)=>{A().chatGPT.getChatGptModelInfo({id:e}).then((({err_code:e,data:t})=>{e||a(t)})).catch((e=>{t(e)}))}))})};const $={class:"spell-form"},J={class:"picture cb-flex"},K=["onClick"],N={class:"picture"},X={class:"picture-img"},Y=["src","alt"],Z={class:"picture-mask"},ee={class:"picture-mask-box cb-flex"},ae={class:"picture-info cb-single-line"},te=v({__name:"SelectModalImg",props:{modelValue:{type:[Boolean],default:!1},editData:{type:[Array],default:()=>null},typePlatform:{type:String,default:"2"}},emits:["update:modelValue","onSuccess"],setup(e,{emit:a}){const t=e,l=b(-1),{resourcesList:o,onGetResourcesList:s}=(()=>{const e=b([]),a=m({page:{page:1,per_page:20},total:0}),t=async(t={})=>{try{const{err_code:l,data:o,meta:s}=await A().resources.materialList(r(r({},a.page),t));l||(e.value=o,a.total=s.total)}catch(l){}};return d(r({resourcesList:e},h(a)),{handleSaveResources:async(e,a)=>{try{const{err_code:t}=await A().resources.materialSave(e);t||(y.success("新增成功"),a&&a())}catch(t){}},handleDeleteResources:async(e,a)=>{g.confirm("确定删除吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error"}).then((async()=>{try{const{err_code:l}=await A().resources.materialDel({id:e});l||(y.success("删除成功"),t(a))}catch(l){}}))},onGetResourcesList:t})})(),{getEditId:n,getEdit:c,handlePopup:p}=L({props:t,emit:a,watchShow:e=>{t.modelValue&&s({type:V(t.typePlatform),is_all:1}),t.editData}}),u=()=>{if(V(l)<0)return y.error("请选择图片");a("onSuccess",o.value[V(l)]),p(!1)};return(a,t)=>{const s=w("el-icon");return _(),C("div",null,[x(V(i),{"dialog-props":{title:"模型图片",modelValue:e.modelValue,showClose:!0,width:"850px"},scrollBarProps:{maxHeight:700},center:"",top:"10vh",onCancel:t[0]||(t[0]=e=>V(p)(!1)),onSubmit:u},{default:P((()=>[k("div",$,[k("div",J,[(_(!0),C(D,null,S(V(o),((e,a)=>(_(),C("div",{key:e.id,onClick:e=>l.value=a,class:M(["picture-item cb-m-r-10 cb-m-b-10",{active:a===l.value}])},[k("div",N,[k("div",X,[k("img",{src:e.file_url,class:"img",alt:e.title},null,8,Y)]),k("div",Z,[k("div",ee,[x(s,{size:66,color:"#ffffff"},{default:P((()=>[x(V(I))])),_:1})])])]),k("div",ae,T(e.title),1)],10,K)))),128))])])])),_:1},8,["dialog-props"])])}}});const le={class:"package"},oe=G("查看示例"),se=G("点击前往选择"),ne={key:0},re={key:1},de=G("对话式 "),ie=k("span",{class:"package-tip"},"无限聊天的效果",-1),ce=["src"],pe=v({__name:"ListCreateDialog",props:{modelValue:{type:[Boolean],default:!1},editData:{type:[Array],default:()=>null},platform:{type:String,default:"1"}},emits:["update:modelValue","reload"],setup(e,{emit:a}){const t=e,l=b(!1),o=b(!1),{register:s,validate:n,setFieldsValue:u,resetFields:m,setProps:f}=H({schemas:Q(!1,"2"==t.platform)}),{getEditId:h,getEdit:y,handlePopup:g}=L({props:t,emit:a,watchShow:e=>{t.editData&&U((()=>{u(d(r({},t.editData),{icon:"2"==t.platform?t.editData.icon?[{url:t.editData.icon}]:[]:t.editData.icon||""}));const e=2==t.editData.type;f({schemas:Q(e,"2"==t.platform)})}))}}),{onCreateModel:v}=W(),D=async()=>{const e=await n();"2"==t.platform&&e.icon&&(e.icon=e.icon[0].url);const l=t.editData?d(r({},e),{platform:t.platform,id:t.editData.id}):d(r({},e),{platform:t.platform});v(l,(()=>{g(),a("reload")}))},S=()=>{g(!1),m()},M=()=>{window.open("https://icon-sets.iconify.design/","_blank")},I=e=>{u({icon:[{url:e.file_url}]})};return(a,t)=>{const n=w("el-input"),r=w("el-button"),d=w("el-radio"),u=w("el-radio-group"),m=w("el-dialog");return _(),C("div",null,[x(V(i),{"dialog-props":{title:"模型新增",modelValue:e.modelValue,showClose:!0,width:"1200px"},scrollBarProps:{maxHeight:600},center:"",top:"10vh",onCancel:S,onSubmit:D},{default:P((()=>[k("div",le,[x(V(c),{onRegister:V(s)},{icon:P((({model:e,field:a})=>[k("div",null,[x(n,{modelValue:e[a],"onUpdate:modelValue":t=>e[a]=t,placeholder:"请输入模型图片",class:"input-with-select"},null,8,["modelValue","onUpdate:modelValue"]),x(r,{link:"",onClick:t[0]||(t[0]=e=>l.value=!0),size:"small"},{default:P((()=>[oe])),_:1}),x(r,{link:"",onClick:M,size:"small"},{default:P((()=>[se])),_:1})])])),prompt:P((({model:e,field:a})=>[2==e.type?(_(),C("div",ne,[x(n,{modelValue:e[a],"onUpdate:modelValue":t=>e[a]=t,type:"textarea",rows:4,placeholder:"请输入模型图片"},null,8,["modelValue","onUpdate:modelValue"])])):(_(),C("div",re,[x(V(p),{modelValue:e[a],"onUpdate:modelValue":t=>e[a]=t},null,8,["modelValue","onUpdate:modelValue"])]))])),type:P((({model:e,field:a})=>[x(u,{modelValue:e[a],"onUpdate:modelValue":t=>e[a]=t},{default:P((()=>[x(d,{label:"1"},{default:P((()=>[de,ie])),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1},8,["onRegister"])])])),_:1},8,["dialog-props"]),x(m,{modelValue:l.value,"onUpdate:modelValue":t[1]||(t[1]=e=>l.value=e),width:"60%"},{default:P((()=>[k("img",{src:V("/admin/assets/v2_rrupxd.6bf02d46.png"),style:{width:"100%"}},null,8,ce)])),_:1},8,["modelValue"]),x(te,{modelValue:o.value,"onUpdate:modelValue":t[2]||(t[2]=e=>o.value=e),onOnSuccess:I},null,8,["modelValue"])])}}});const ue={class:"cb-page model"},me={class:"cb-flex"},fe=k("span",{class:"cb-p-t-2"},"新增",-1),he=["src","alt"],ye=G(" 编辑 "),be=G(" 删除 "),ge=v({__name:"index",setup(e){const a=b(null),t=m({});b(""),b(null);const l=j(),{openEdit:o,editData:s,showDialog:n}=L({}),{onModelShow:i,handleModelTop:c,onGetModalInfo:p}=W(),f={style:{marginBottom:"20px"}},{registerTable:h,reload:v}=F({columns:[{label:"模型名称",prop:"name"},{label:"模型描述",prop:"desc",customRender:({desc:e})=>e||"--"},{label:"使用量",prop:"uses"},{label:"状态",prop:"status",slot:"状态"},{label:"置顶",prop:"sort",slot:"置顶"},{label:"操作",width:340,slot:"handles"}],formSchemas:[{field:"name",component:"Input",label:"模板名称：",componentProps:{placeholder:"请输入模板名称"}},{field:"status",component:"Select",label:"状态：",componentProps:{style:{width:"100%"},options:[{label:"上架",value:"1"},{label:"下架",value:"2"}]}}],formConfig:{labelWidth:100,baseColProps:{span:8}}});R((async()=>{if(l.query.id){const e=await p(l.query.id);delete e.id,delete e.icon,o(e)}}));const D=e=>{t.created_at=(e.created_at||[]).join("~")},S=()=>{V(a).reload()};return(e,l)=>{const p=w("el-icon"),m=w("el-button"),b=w("el-switch");return _(),C("div",ue,[x(V(u),{onRegister:V(h),api:V(A)().chatGPT.getChatGptModel,onHandleSearchInfoChange:D,"form-card-options":f,extraParams:d(r({},t),{platform:"1"}),ref_key:"tableRef",ref:a},{"cb-table-header":P((()=>[x(m,{type:"primary",onClick:l[0]||(l[0]=e=>V(o)(null))},{default:P((()=>[k("div",me,[x(p,{size:20,class:"cb-m-r-2"},{default:P((()=>[x(V(B))])),_:1}),fe])])),_:1})])),"模型图片":P((e=>[e.icon?(_(),C("img",{key:0,src:e.icon,alt:e.name,style:{width:"60px",height:"60px"}},null,8,he)):O("",!0)])),"状态":P((e=>[x(b,{modelValue:e.status,"onUpdate:modelValue":a=>e.status=a,"active-value":1,"inactive-value":2,onClick:a=>{i(e,(()=>{S()}),"gpt")}},null,8,["modelValue","onUpdate:modelValue","onClick"])])),"置顶":P((e=>[x(b,{modelValue:e.sort,"onUpdate:modelValue":a=>e.sort=a,"active-value":0===e.sort?1:e.sort,"inactive-value":0,onClick:a=>(async(e,a)=>{c(e,a,(()=>{S()}))})(e.id,0===e.sort)},null,8,["modelValue","onUpdate:modelValue","active-value","onClick"])])),handles:P((e=>[x(m,{style:{color:"#9a9a9a","font-size":"12px"},icon:V(z),size:"small",onClick:a=>V(o)(e)},{default:P((()=>[ye])),_:2},1032,["icon","onClick"]),x(m,{style:{"font-size":"12px"},icon:V(q),size:"small",type:"danger",onClick:a=>(e=>{g.confirm("确定删除吗？",{confirmButtonText:"确认",cancelButtonText:"取消",type:"error"}).then((async()=>{await A().chatGPT.delModel(e.id),y.success("删除成功"),v()}))})(e)},{default:P((()=>[be])),_:2},1032,["icon","onClick"])])),_:1},8,["onRegister","api","extraParams"]),x(pe,{modelValue:V(n),"onUpdate:modelValue":l[1]||(l[1]=e=>E(n)?n.value=e:null),editData:V(s),platform:1,onReload:S},null,8,["modelValue","editData"])])}}});export{ge as default};
