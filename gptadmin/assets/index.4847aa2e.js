var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,i=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,r=(e,a)=>{for(var t in a||(a={}))o.call(a,t)&&i(e,t,a[t]);if(l)for(var t of l(a))s.call(a,t)&&i(e,t,a[t]);return e};import{c as d,d as n,e as p}from"./index.7bae97b9.js";import{a as c,_ as u}from"./index.ed21fdb7.js";import{ay as m,d as b,i as h,c as f,f as g,w as v,b as y,u as w,E as _,a as x,r as P,P as D,Q as k,g as V,t as j,e as O,v as C,x as T,h as R,aA as S}from"./vendor.1bc4be78.js";import{u as B}from"./useBasicTable.8c567ae6.js";import{u as G}from"./useDialog.6d3ee2da.js";import{u as E}from"./useBasicForm.d295827a.js";const $=[{field:"package_id",label:"赠送套餐：",component:"ApiSelect",defaultValue:[],componentProps:{placeholder:"请选择套餐",style:{width:"100%"},api:c().chatGPT.packageList,resultField:"data",labelField:"name",valueField:"id",filterable:!0}}],F={class:"box"},I=b({__name:"GiftDialog",props:{modelValue:{type:[Boolean],default:!1},editData:{type:[null,Object],default:()=>null}},emits:["update:modelValue","reload"],setup(e,{emit:a}){const t=e,{register:l,validate:o}=E({schemas:$}),{handlePopup:s}=G({emit:a,props:t,watchShow:async()=>{t.editData}}),i=async()=>{try{const{id:l}=t.editData,i=await o();if(!i.package_id)return void _.error("请选择套餐");try{await c().chatGPT.sendPackage(r({user_id:l},i)),_.success("赠送成功")}catch(e){}s(!1),a("reload")}catch(e){}};return(a,t)=>(h(),f("div",null,[g(w(n),{"dialog-props":{title:"赠送套餐",modelValue:e.modelValue,showClose:!0,width:"400px"},center:"",onCancel:t[0]||(t[0]=e=>w(s)(!1)),onSubmit:i},{default:v((()=>[y("div",F,[g(w(d),{onRegister:w(l)},null,8,["onRegister"])])])),_:1},8,["dialog-props"])]))}});const A=e=>(C("data-v-d4c57166"),e=e(),T(),e),L={key:0,class:"box"},U={class:"box-balance"},M=A((()=>y("div",{class:"box-balance-title"}," 套餐余额： ",-1))),Q={class:"cb-m-r-25"},q=A((()=>y("span",null,"套餐名称：",-1))),z={key:0},H=A((()=>y("span",null,"到期时间：",-1))),J={key:1},K=A((()=>y("span",null,"剩余有效次数：",-1)));var N=u(b({__name:"BalanceDetail",props:{modelValue:{type:[Boolean],default:!1},editData:{type:[null,Object],default:()=>null}},emits:["update:modelValue","reload"],setup(e,{emit:l}){const o=e,s=x({}),i=P([]),{registerTable:d,reload:u}=B({columns:[{label:"套餐名称",prop:"package_name"},{label:"问答机会",prop:"num",slot:"num",width:"120"},{label:"日期",prop:"created_at"}],showTableCard:!1}),{handlePopup:m}=G({emit:l,props:o,watchShow:async()=>{if(o.editData){const{id:e}=o.editData,{data:a}=await c().chatGPT.getEnablePackage({user_id:e});i.value=a}}});return(l,o)=>(h(),f("div",null,[g(w(n),{"dialog-props":{title:"套餐余额",modelValue:e.modelValue,showClose:!0,width:"650px"},"btn-props":{submitBtnOptions:{show:!1}},center:"",onCancel:o[0]||(o[0]=e=>w(m)(!1))},{default:v((()=>{return[e.modelValue&&e.editData?(h(),f("div",L,[y("div",U,[M,(h(!0),f(D,null,k(i.value,(e=>(h(),f("div",{key:e.id,class:"box-balance-item cb-flex"},[y("div",Q,[q,V(j(e.name),1)]),-1===e.num?(h(),f("div",z,[H,V(j(e.expired_at),1)])):(h(),f("div",J,[K,V(j(e.num-e.used),1)]))])))),128))]),g(w(p),{onRegister:w(d),api:l.$api.user.getPackageRecord,height:"auto",extraParams:(o=r({},s),n={user_id:e.editData.id},a(o,t(n)))},{num:v((e=>[V(j(-1===e.num?`+ ${e.expired_day}天`:`+ ${e.num}次`),1)])),_:1},8,["onRegister","api","extraParams"])])):O("",!0)];var o,n})),_:1},8,["dialog-props"])]))}}),[["__scopeId","data-v-d4c57166"]]);const W={class:"cb-page page-user"},X=V(" 查看 "),Y=V(" 赠送 "),Z=b({__name:"index",setup(e){const{showDialog:a,editData:t,openEdit:l}=G({}),{showDialog:o,editData:s,openEdit:i}=G({}),{registerTable:r,reload:d}=B({columns:[{label:"头像",prop:"avatar",slot:"avatar",width:100},{label:"昵称",prop:"nickname"},{label:"手机号",prop:"mobile",width:200},{label:"套餐余额",slot:"balance",width:100},{label:"创建时间",prop:"register_at",width:200},{label:"用户状态",prop:"status",customRender:({status:e})=>{const a={1:"正常",2:"冻结中"};return 1==e?a[e]:m("span",{style:{color:"red"}},{default:()=>a[e]})}},{label:"操作",width:100,slot:"handles"}],formSchemas:[{field:"nickname",component:"Input",label:"昵称",componentProps:{placeholder:"请输入昵称"}},{field:"mobile",component:"Input",label:"手机号",componentProps:{placeholder:"请输入手机号"}}]});return(e,n)=>{const u=R("el-image"),m=R("el-button");return h(),f("div",W,[g(w(p),{onRegister:w(r),api:e.$api.chatGPT.memberList},{avatar:v((({avatar:a})=>[g(u,{style:{width:"50px",height:"50px"},src:a||e.$images.default,fit:"fill"},null,8,["src"])])),balance:v((e=>[g(m,{type:"text",onClick:a=>w(i)(e)},{default:v((()=>[X])),_:2},1032,["onClick"])])),handles:v((e=>[g(m,{type:"text",onClick:a=>w(l)(e)},{default:v((()=>[Y])),_:2},1032,["onClick"]),g(m,{type:"text",onClick:a=>(async e=>{await c().chatGPT.changeMemberStatus(e.id),_.success("修改成功"),d()})(e)},{default:v((()=>[V(j(1===e.status?"封禁":"解封"),1)])),_:2},1032,["onClick"])])),_:1},8,["onRegister","api"]),g(I,{modelValue:w(a),"onUpdate:modelValue":n[0]||(n[0]=e=>S(a)?a.value=e:null),editData:w(t)},null,8,["modelValue","editData"]),g(N,{modelValue:w(o),"onUpdate:modelValue":n[1]||(n[1]=e=>S(o)?o.value=e:null),editData:w(s)},null,8,["modelValue","editData"])])}}});export{Z as default};
