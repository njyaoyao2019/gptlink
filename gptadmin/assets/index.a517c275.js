var e=Object.defineProperty,a=Object.defineProperties,s=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,d=(a,s,t)=>s in a?e(a,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[s]=t;import{r as i,E as r,d as n,n as c,h as u,i as p,c as m,f as v,w as b,b as f,u as h,v as g,x as k,m as w,o as _,s as x,j as y,bc as V,bb as T,e as P,aA as S}from"./vendor.1bc4be78.js";import{c as C,d as D}from"./index.7bae97b9.js";import{u as I}from"./useDialog.6d3ee2da.js";import{u as U}from"./useBasicForm.d295827a.js";import{a as j,U as O,_ as R}from"./index.ed21fdb7.js";const q=e=>({register:G,invite:z,share:z}[e]),F=[{field:"platform",component:"Input",label:"服务应用：",slot:"platform",show:!1},{field:"status",component:"Input",label:"状态：",required:!0,defaultValue:"2",show:!1},{field:"package_id",component:"ApiSelect",label:"套餐：",componentProps:{style:{width:"100%"},api:j().chatGPT.packageList,resultField:"data",labelField:"name",valueField:"id"},required:!0}],G=[{field:"name",component:"Input",label:"任务事件：",componentProps:{disabled:!0}},...F],z=[{field:"name",component:"Input",label:"任务事件：",componentProps:{disabled:!0}},{field:"title",component:"Input",label:"标题",required:!0,slot:"title"},{field:"desc",component:"Input",label:"描述",required:!0,slot:"desc"},...F,{field:"share_image",component:"Upload",label:"图片：",componentProps:{maxSize:5,maxCount:1,mode:"upload",httpRequest:O},defaultValue:"",show:!1,colProps:{span:24}}],A=()=>{const e=i(null);return{taskData:e,onGetTaskInfo:()=>{const a=["getTaskRegister","getTaskInvite","getTaskShare"];Promise.all([...a.map((e=>j().chatGPT[e]().then((({data:e})=>Array.isArray(e)?{status:2}:e)).catch((e=>{}))))]).then((a=>{e.value={register:a[0],invite:a[1],share:a[2]}}))},handleSaveTask:(a,s,t,l)=>{j().chatGPT[s](a).then((({data:a})=>{r.success("保存成功"),e.value,l&&l(a)})).catch((e=>{}))},handleUpdateTaskStatus:e=>{j().chatGPT.updateTaskStatus({type:e}).then((()=>{r.success("保存成功")})).catch((e=>{}))}}};const E=e=>(g("data-v-7034ea00"),e=e(),k(),e),B={class:"package"},H=E((()=>f("p",{class:"desc"},"用户任务中心，显示名称信息，10字以内",-1))),L=E((()=>f("p",{class:"desc"},"当前任务描述，30字以内",-1)));var J=R(n({__name:"createDialog",props:{formType:{type:String,default:"register"},modelValue:{type:[Boolean],default:!1},editData:{type:[Array],default:()=>null}},emits:["update:modelValue","reload","saveSuccess"],setup(e,{expose:r,emit:n}){const g=e,k=i([]),{handleSaveTask:w}=A(),{register:_,validate:x,setFieldsValue:y,resetFields:V,setProps:T}=U({schemas:q(g.formType)}),P={register:"新用户注册",invite:"邀请好友",share:"每日分享"},S=c((()=>P[g.formType])),{getEditId:j,getEdit:O,handlePopup:R}=I({props:g,emit:n,watchShow:e=>{g.editData&&setTimeout((()=>{const{status:e,share_image:i}=g.editData;var r;y((r=((e,a)=>{for(var s in a||(a={}))l.call(a,s)&&d(e,s,a[s]);if(t)for(var s of t(a))o.call(a,s)&&d(e,s,a[s]);return e})({},g.editData),a(r,s({status:e,share_image:i?[{url:i}]:""}))))}),100)}}),F=async()=>{const e={H5:"h5",PC:"pc","小程序":"mini"},a=await x();a.platform=k.value.map((a=>e[a])),a.type={"新用户注册":"register","邀请朋友":"invite","每日分享":"share"}[a.name],a.share_image&&a.share_image[0]?a.share_image=a.share_image[0].url:a.share_image="",w(a,{register:"savaTaskRegister",invite:"savaTaskInvite",share:"savaTaskShare"}[g.formType],g.formType,(e=>{G(),n("saveSuccess",e)}))},G=()=>{R(!1),V()},z=e=>{k.value=e};return r({handleCheckSchema:()=>{const e=q(g.formType);setTimeout((()=>{T({schemas:e}),y({name:S.value,package_id:""})}),100)}}),(a,s)=>{const t=u("el-checkbox"),l=u("el-checkbox-group"),o=u("el-input");return p(),m("div",null,[v(h(D),{"dialog-props":{title:"任务配置",modelValue:e.modelValue,showClose:!0,width:"700px"},scrollBarProps:{maxHeight:500},center:"",top:"10vh",onCancel:G,onSubmit:F},{default:b((()=>[f("div",B,[v(h(C),{onRegister:h(_)},{platform:b((({model:e,field:a})=>[v(l,{modelValue:e[a],"onUpdate:modelValue":s=>e[a]=s,onChange:z},{default:b((()=>[v(t,{label:"H5"}),v(t,{label:"PC"}),v(t,{label:"小程序"})])),_:2},1032,["modelValue","onUpdate:modelValue"])])),title:b((({model:e,field:a})=>[v(o,{modelValue:e[a],"onUpdate:modelValue":s=>e[a]=s,placeholder:"请输入标题",maxlength:"10"},null,8,["modelValue","onUpdate:modelValue"]),H])),desc:b((({model:e,field:a})=>[v(o,{modelValue:e[a],"onUpdate:modelValue":s=>e[a]=s,autosize:{minRows:2,maxRows:4},placeholder:"请输入描述",maxlength:"30"},null,8,["modelValue","onUpdate:modelValue"]),L])),_:1},8,["onRegister"])])])),_:1},8,["dialog-props"])])}}}),[["__scopeId","data-v-7034ea00"]]);const K=e=>(g("data-v-29493155"),e=e(),k(),e),M={class:"cb-page task"},N={class:"task-warp cb-m-b-15 cb-flex"},Q={class:"task-avatar"},W={class:"cb-flex-1"},X={class:"cb-flex cb-row-between cb-m-b-10"},Y=K((()=>f("span",{class:"task-name"},"新用户注册",-1))),Z=K((()=>f("div",{class:"task-desc cb-double-line"}," 新用户注册成功后，即给该用户账户充值相应套餐。 ",-1))),$={class:"task-btn cb-flex cb-row-around"},ee={class:"task-warp cb-m-b-15 cb-flex"},ae={class:"task-avatar"},se={class:"cb-flex-1"},te={class:"cb-flex cb-row-between cb-m-b-10"},le=K((()=>f("span",{class:"task-name"},"邀请好友",-1))),oe=K((()=>f("div",{class:"task-desc cb-double-line"}," 用户发出邀请链接，新用户通过转发邀请链接注册成功，即给该用户账户充值相应套餐 ",-1))),de={class:"task-btn cb-flex cb-row-around"},ie={class:"task-warp cb-m-b-15 cb-flex"},re={class:"task-avatar"},ne={class:"cb-flex-1"},ce={class:"cb-flex cb-row-between cb-m-b-10"},ue=K((()=>f("span",{class:"task-name"},"每日分享",-1))),pe=K((()=>f("div",{class:"task-desc cb-double-line"}," 用户发起分享，每日（0：00 - 23：59）多次发起分享，只给该用户账户充值1次相应套餐 ",-1))),me={class:"task-btn cb-flex cb-row-around"};var ve=R(n({__name:"index",setup(e){const{openEdit:a,editData:s,showDialog:t}=I({}),{taskData:l,onGetTaskInfo:o,handleSaveTask:d,handleUpdateTaskStatus:n}=A(),c=w(),g=i("register"),k=i(null),C=(e,s)=>{g.value=e,setTimeout((()=>{h(k).handleCheckSchema(),a(s)}),200)},D=e=>{c.push({path:"/operate/marketing/send",query:{type:e}})},U=(e,a)=>{if(a)return r.error("前往任务配置，配置完成后再开启任务哦！");n(e)},j=e=>{l.value[g.value]=e};return _((()=>{o()})),(e,a)=>{const o=u("el-icon"),d=u("el-switch"),i=u("el-divider"),r=u("el-card"),n=u("el-col"),c=u("el-row");return p(),m("div",M,[h(l)?(p(),x(r,{key:0,header:"任务中心"},{default:b((()=>[v(c,null,{default:b((()=>[v(n,{span:8},{default:b((()=>[v(r,{shadow:"never"},{default:b((()=>[f("div",N,[f("div",Q,[v(o,{size:26,color:"#fff"},{default:b((()=>[v(h(y))])),_:1})]),f("div",W,[f("div",X,[Y,v(d,{modelValue:h(l).register.status,"onUpdate:modelValue":a[0]||(a[0]=e=>h(l).register.status=e),"active-value":1,"inactive-value":2,disabled:!h(l).register.id,onClick:a[1]||(a[1]=e=>U("register",!h(l).register.id))},null,8,["modelValue","disabled"])]),Z])]),v(i,{"border-style":"dashed"}),f("div",$,[f("div",{class:"text",onClick:a[2]||(a[2]=e=>D("register"))},"查看记录"),v(i,{direction:"vertical"}),f("div",{class:"text",onClick:a[3]||(a[3]=e=>C("register",h(l).register))},"任务配置")])])),_:1})])),_:1}),v(n,{span:8},{default:b((()=>[v(r,{shadow:"never"},{default:b((()=>[f("div",ee,[f("div",ae,[v(o,{size:26,color:"#fff"},{default:b((()=>[v(h(V))])),_:1})]),f("div",se,[f("div",te,[le,v(d,{modelValue:h(l).invite.status,"onUpdate:modelValue":a[4]||(a[4]=e=>h(l).invite.status=e),"active-value":1,"inactive-value":2,disabled:!h(l).invite.id,onClick:a[5]||(a[5]=e=>U("invite",!h(l).invite.id))},null,8,["modelValue","disabled"])]),oe])]),v(i,{"border-style":"dashed"}),f("div",de,[f("div",{class:"text",onClick:a[6]||(a[6]=e=>D("invite"))},"查看记录"),v(i,{direction:"vertical"}),f("div",{class:"text",onClick:a[7]||(a[7]=e=>C("invite",h(l).invite))},"任务配置")])])),_:1})])),_:1}),v(n,{span:8},{default:b((()=>[v(r,{shadow:"never"},{default:b((()=>[f("div",ie,[f("div",re,[v(o,{size:26,color:"#fff"},{default:b((()=>[v(h(T))])),_:1})]),f("div",ne,[f("div",ce,[ue,v(d,{modelValue:h(l).share.status,"onUpdate:modelValue":a[8]||(a[8]=e=>h(l).share.status=e),"active-value":1,"inactive-value":2,disabled:!h(l).share.id,onClick:a[9]||(a[9]=e=>U("share",!h(l).share.id))},null,8,["modelValue","disabled"])]),pe])]),v(i,{"border-style":"dashed"}),f("div",me,[f("div",{class:"text",onClick:a[10]||(a[10]=e=>D("share"))},"查看记录"),v(i,{direction:"vertical"}),f("div",{class:"text",onClick:a[11]||(a[11]=e=>C("share",h(l).share))},"任务配置")])])),_:1})])),_:1})])),_:1})])),_:1})):P("",!0),v(J,{modelValue:h(t),"onUpdate:modelValue":a[12]||(a[12]=e=>S(t)?t.value=e:null),editData:h(s),formType:g.value,onSaveSuccess:j,ref_key:"createDialogRef",ref:k},null,8,["modelValue","editData","formType"])])}}}),[["__scopeId","data-v-29493155"]]);export{ve as default};
